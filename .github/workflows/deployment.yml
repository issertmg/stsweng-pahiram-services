# This workflow will do a clean install of node dependencies, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Continuous Deployment

on:
  push:
    branches: [master]

jobs:
  test_pull_request:

    runs-on: ubuntu-latest

    steps:
    - name: Setup Node.js
    - uses: actions/checkout@v2
      uses: actions/setup-node@v1
      with:
        node-version: 12
    - run: npm ci
    - run: npm test

    - name: Automated Version Bump
      uses: phips28/gh-action-bump-version@v8.0.18
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag-prefix: ''

    - name: Push to Heroku
      uses: actions/checkout@v1
      run: git push -f https://heroku:${{ secrets.HEROKU_API_KEY }}@git.heroku.com/dlsu-pahiram-services.git origin/master:master

    # - name: Set up QEMU
    #   uses: docker/setup-qemu-action@v1
    # - name: Set up Docker Buildx
    #   uses: docker/setup-buildx-action@v1
    # - name: Login to DockerHub
    #   uses: docker/login-action@v1
    #   with:
    #     username: ${{ secrets.DOCKERHUB_USERNAME }}
    #     password: ${{ secrets.DOCKERHUB_TOKEN }}
    # - name: Build and push Docker images
    #   uses: docker/build-push-action@v2.2.1
    #   with:
    #     push: true
    #     tags: issergagan/stsweng-pahiram-services:latest

    # - name: Deploy to Heroku
    #   uses: AkhileshNS/heroku-deploy@v3.6.8
    #   with:
    #     heroku_api_key: ${{secrets.HEROKU_API_KEY}}
    #     heroku_app_name: dlsu-pahiram-services
    #     heroku_email: keith_gabriel_badulis@dlsu.edu.ph

